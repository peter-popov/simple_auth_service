---
test_name: New user logs in without MFA tocken

stages:
  - name: Register a new user
    request:
      url: http://localhost:5000/auth/signup
      method: POST
      json:
        email: mfa_user@test.com
        username: MFA User
        password: qwerty
    response:
      status_code: 201
      save:
        body:
          verify_email_url: link_in_email

  - name: Verify email
    request:
      url: "{verify_email_url:s}"
      method: GET
    response:
      status_code: 200

  - name: User login
    request:
      url: http://localhost:5000/auth/login
      method: GET
      auth:
        - mfa_user@test.com
        - qwerty
    response:
      status_code: 200
      body:
        access_token: !anystr
        expires_in: !anyint
      save:
        body:
          access_token: access_token

  - name: No-mfa user can access the profile
    request:
      url: http://localhost:5000/user/profile
      method: GET
      headers:
        Authorization: "Bearer {access_token:s}"
    response:
      status_code: 200
      body:
        email: mfa_user@test.com

  - name: No-mfa user cannot access vehciles
    request:
      url: http://localhost:5000/vehicle/drive
      method: GET
      headers:
        Authorization: "Bearer {access_token:s}"
    response:
      status_code: 401